/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Xr=Object.defineProperty;var vn=Object.getOwnPropertyDescriptor;var $n=Object.getOwnPropertyNames;var Fn=Object.prototype.hasOwnProperty;var Tn=(s,e)=>{for(var t in e)Xr(s,t,{get:e[t],enumerable:!0})},kn=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of $n(e))!Fn.call(s,n)&&n!==t&&Xr(s,n,{get:()=>e[n],enumerable:!(r=vn(e,n))||r.enumerable});return s};var Nn=s=>kn(Xr({},"__esModule",{value:!0}),s);var si={};Tn(si,{default:()=>Vr});module.exports=Nn(si);var te=require("obsidian");var wr="RFC3986",yr={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:s=>String(s)},Ns="RFC1738";var Mn=Array.isArray,ie=(()=>{let s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})();var Gr=1024,Ms=(s,e,t,r,n)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=Gr){let c=a.length>=Gr?a.slice(o,o+Gr):a,u=[];for(let w=0;w<c.length;++w){let f=c.charCodeAt(w);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||n===Ns&&(f===40||f===41)){u[u.length]=c.charAt(w);continue}if(f<128){u[u.length]=ie[f];continue}if(f<2048){u[u.length]=ie[192|f>>6]+ie[128|f&63];continue}if(f<55296||f>=57344){u[u.length]=ie[224|f>>12]+ie[128|f>>6&63]+ie[128|f&63];continue}w+=1,f=65536+((f&1023)<<10|c.charCodeAt(w)&1023),u[u.length]=ie[240|f>>18]+ie[128|f>>12&63]+ie[128|f>>6&63]+ie[128|f&63]}i+=u.join("")}return i};function Bs(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Kr(s,e){if(Mn(s)){let t=[];for(let r=0;r<s.length;r+=1)t.push(e(s[r]));return t}return e(s)}var Bn=Object.prototype.hasOwnProperty,Ls={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},oe=Array.isArray,Ln=Array.prototype.push,Ds=function(s,e){Ln.apply(s,oe(e)?e:[e])},Dn=Date.prototype.toISOString,D={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ms,encodeValuesOnly:!1,format:wr,formatter:yr[wr],indices:!1,serializeDate(s){return Dn.call(s)},skipNulls:!1,strictNullHandling:!1};function jn(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}var Qr={};function js(s,e,t,r,n,a,i,o,c,u,w,f,d,m,y,C,g,k){let _=s,E=k,N=0,b=!1;for(;(E=E.get(Qr))!==void 0&&!b;){let R=E.get(s);if(N+=1,typeof R!="undefined"){if(R===N)throw new RangeError("Cyclic object value");b=!0}typeof E.get(Qr)=="undefined"&&(N=0)}if(typeof u=="function"?_=u(e,_):_ instanceof Date?_=d==null?void 0:d(_):t==="comma"&&oe(_)&&(_=Kr(_,function(R){return R instanceof Date?d==null?void 0:d(R):R})),_===null){if(a)return c&&!C?c(e,D.encoder,g,"key",m):e;_=""}if(jn(_)||Bs(_)){if(c){let R=C?e:c(e,D.encoder,g,"key",m);return[(y==null?void 0:y(R))+"="+(y==null?void 0:y(c(_,D.encoder,g,"value",m)))]}return[(y==null?void 0:y(e))+"="+(y==null?void 0:y(String(_)))]}let T=[];if(typeof _=="undefined")return T;let $;if(t==="comma"&&oe(_))C&&c&&(_=Kr(_,c)),$=[{value:_.length>0?_.join(",")||null:void 0}];else if(oe(u))$=u;else{let R=Object.keys(_);$=w?R.sort(w):R}let v=o?String(e).replace(/\./g,"%2E"):String(e),I=r&&oe(_)&&_.length===1?v+"[]":v;if(n&&oe(_)&&_.length===0)return I+"[]";for(let R=0;R<$.length;++R){let F=$[R],S=typeof F=="object"&&typeof F.value!="undefined"?F.value:_[F];if(i&&S===null)continue;let Z=f&&o?F.replace(/\./g,"%2E"):F,me=oe(_)?typeof t=="function"?t(I,Z):I:I+(f?"."+Z:"["+Z+"]");k.set(s,N);let X=new WeakMap;X.set(Qr,k),Ds(T,js(S,me,t,r,n,a,i,o,t==="comma"&&C&&oe(_)?null:c,u,w,f,d,m,y,C,g,X))}return T}function Un(s=D){if(typeof s.allowEmptyArrays!="undefined"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys!="undefined"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder!="undefined"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=s.charset||D.charset;if(typeof s.charset!="undefined"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=wr;if(typeof s.format!="undefined"){if(!Bn.call(yr,s.format))throw new TypeError("Unknown format option provided.");t=s.format}let r=yr[t],n=D.filter;(typeof s.filter=="function"||oe(s.filter))&&(n=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in Ls?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=D.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof s.allowDots=="undefined"?s.encodeDotInKeys?!0:D.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:D.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:D.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:D.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter=="undefined"?D.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:D.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:D.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:D.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:D.encodeValuesOnly,filter:n,format:t,formatter:r,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:D.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:D.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:D.strictNullHandling}}function zr(s,e={}){let t=s,r=Un(e),n,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):oe(r.filter)&&(a=r.filter,n=a);let i=[];if(typeof t!="object"||t===null)return"";let o=Ls[r.arrayFormat],c=o==="comma"&&r.commaRoundTrip;n||(n=Object.keys(t)),r.sort&&n.sort(r.sort);let u=new WeakMap;for(let d=0;d<n.length;++d){let m=n[d];r.skipNulls&&t[m]===null||Ds(i,js(t[m],m,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}let w=i.join(r.delimiter),f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),w.length>0?f+w:""}var He="4.98.0";var Us=!1,Ve,Yr,Wn,Jn,Hn,Zr,Vn,br,es,ts,rs,xr,ss;function qs(s,e={auto:!1}){if(Us)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(Ve)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${Ve}'\``);Us=e.auto,Ve=s.kind,Yr=s.fetch,Wn=s.Request,Jn=s.Response,Hn=s.Headers,Zr=s.FormData,Vn=s.Blob,br=s.File,es=s.ReadableStream,ts=s.getMultipartRequestOptions,rs=s.getDefaultAgent,xr=s.fileFromPath,ss=s.isFsReadStream}var Ar=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Ws({manuallyImported:s}={}){let e=s?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,n,a;try{t=fetch,r=Request,n=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:a,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Ar(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}var ns=()=>{Ve||qs(Ws(),{auto:!0})};ns();var h=class extends Error{},B=class extends h{constructor(e,t,r,n){super(`${B.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.request_id=n==null?void 0:n["x-request-id"],this.error=t;let a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,r){let n=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new Ie({message:r,cause:Pr(t)});let a=t==null?void 0:t.error;return e===400?new Qt(e,a,r,n):e===401?new zt(e,a,r,n):e===403?new Yt(e,a,r,n):e===404?new Zt(e,a,r,n):e===409?new er(e,a,r,n):e===422?new tr(e,a,r,n):e===429?new rr(e,a,r,n):e>=500?new sr(e,a,r,n):new B(e,a,r,n)}},L=class extends B{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ie=class extends B{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Re=class extends Ie{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Qt=class extends B{},zt=class extends B{},Yt=class extends B{},Zt=class extends B{},er=class extends B{},tr=class extends B{},rr=class extends B{},sr=class extends B{},pt=class extends h{constructor(){super("Could not parse response content as the length limit was reached")}},gt=class extends h{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Ir=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},Xe=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},G,Ge=class{constructor(){G.set(this,void 0),this.buffer=new Uint8Array,Ir(this,G,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let n=[],a;for(;(a=Kn(this.buffer,Xe(this,G,"f")))!=null;){if(a.carriage&&Xe(this,G,"f")==null){Ir(this,G,a.index,"f");continue}if(Xe(this,G,"f")!=null&&(a.index!==Xe(this,G,"f")+1||a.carriage)){n.push(this.decodeText(this.buffer.slice(0,Xe(this,G,"f")-1))),this.buffer=this.buffer.slice(Xe(this,G,"f")),Ir(this,G,null,"f");continue}let i=Xe(this,G,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));n.push(o),this.buffer=this.buffer.slice(a.index),Ir(this,G,null,"f")}return n}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new h(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new h(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new h("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};G=new WeakMap;Ge.NEWLINE_CHARS=new Set([`
`,"\r"]);Ge.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Kn(s,e){for(let n=e!=null?e:0;n<s.length;n++){if(s[n]===10)return{preceding:n,index:n+1,carriage:!1};if(s[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Js(s){for(let r=0;r<s.length-1;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}function as(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var J=class{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*n(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let i of Qn(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(o&&o.error)throw new B(void 0,o.error,void 0,os(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(c){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),c}if(i.event=="error")throw new B(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new J(n,t)}static fromReadableStream(e,t){let r=!1;async function*n(){let i=new Ge,o=as(e);for await(let c of o)for(let u of i.decode(c))yield u;for(let c of i.flush())yield c}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of n())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new J(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new J(()=>n(e),this.controller),new J(()=>n(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new es({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:a,done:i}=await t.next();if(i)return n.close();let o=r.encode(JSON.stringify(a)+`
`);n.enqueue(o)}catch(a){n.error(a)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}};async function*Qn(s,e){if(!s.body)throw e.abort(),new h("Attempted to iterate over a response with no body");let t=new is,r=new Ge,n=as(s.body);for await(let a of zn(n))for(let i of r.decode(a)){let o=t.decode(i);o&&(yield o)}for(let a of r.flush()){let i=t.decode(a);i&&(yield i)}}async function*zn(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let a;for(;(a=Js(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}var is=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=Yn(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function Yn(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}var Hs=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",Vs=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&nr(s),nr=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Zn=s=>Vs(s)||Hs(s)||ss(s);async function us(s,e,t){var n,a,i;if(s=await s,Vs(s))return s;if(Hs(s)){let o=await s.blob();e||(e=(n=new URL(s.url).pathname.split(/[\\/]/).pop())!=null?n:"unknown_file");let c=nr(o)?[await o.arrayBuffer()]:[o];return new br(c,e,t)}let r=await ea(s);if(e||(e=(a=ra(s))!=null?a:"unknown_file"),!(t!=null&&t.type)){let o=(i=r[0])==null?void 0:i.type;typeof o=="string"&&(t={...t,type:o})}return new br(r,e,t)}async function ea(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(nr(s))e.push(await s.arrayBuffer());else if(sa(s))for await(let r of s)e.push(r);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${ta(s)}`);return e}function ta(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function ra(s){var e;return cs(s.name)||cs(s.filename)||((e=cs(s.path))==null?void 0:e.split(/[\\/]/).pop())}var cs=s=>{if(typeof s=="string")return s;if(typeof Buffer!="undefined"&&s instanceof Buffer)return String(s)},sa=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",fs=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody";var ee=async s=>{let e=await Xs(s.body);return ts(e,s)},Xs=async s=>{let e=new Zr;return await Promise.all(Object.entries(s||{}).map(([t,r])=>ls(e,t,r))),e};var ls=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(Zn(t)){let r=await us(t);s.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>ls(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>ls(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var aa=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},ia=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},Rr;ns();async function Ys(s){var i;let{response:e}=s;if(s.options.stream)return pe("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):J.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;let t=e.headers.get("content-type"),r=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.endsWith("+json"))){let o=await e.json();return pe("response",e.status,e.url,e.headers,o),Zs(o,e)}let a=await e.text();return pe("response",e.status,e.url,e.headers,a),a}function Zs(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var _t=class extends Promise{constructor(e,t=Ys){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new _t(this.responsePromise,async t=>Zs(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Sr=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:a}){this.baseURL=e,this.maxRetries=hs("maxRetries",t),this.timeout=hs("timeout",r),this.httpAgent=n,this.fetch=a!=null?a:Yr}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ua(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ma()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async n=>{let a=n&&nr(n==null?void 0:n.body)?new DataView(await n.body.arrayBuffer()):(n==null?void 0:n.body)instanceof DataView?n.body:(n==null?void 0:n.body)instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n==null?void 0:n.body)?new DataView(n.body.buffer):n==null?void 0:n.body;return{method:e,path:t,...n,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var C,g,k,_,E,N;let r={...e},{method:n,path:a,query:i,headers:o={}}=r,c=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:fs(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,u=this.calculateContentLength(c),w=this.buildURL(a,i);"timeout"in r&&hs("timeout",r.timeout),r.timeout=(C=r.timeout)!=null?C:this.timeout;let f=(k=(g=r.httpAgent)!=null?g:this.httpAgent)!=null?k:rs(w),d=r.timeout+1e3;typeof((_=f==null?void 0:f.options)==null?void 0:_.timeout)=="number"&&d>((E=f.options.timeout)!=null?E:0)&&(f.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let m=this.buildHeaders({options:r,headers:o,contentLength:u,retryCount:t});return{req:{method:n,...c&&{body:c},headers:m,...f&&{agent:f},signal:(N=r.signal)!=null?N:null},url:w,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:n}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return Qs(a,i),Qs(a,t),fs(e.body)&&Ve!=="node"&&delete a["content-type"],Er(i,"x-stainless-retry-count")===void 0&&Er(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(n)),Er(i,"x-stainless-timeout")===void 0&&Er(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,n){return B.generate(e,t,r,n)}request(e,t=null){return new _t(this.makeRequest(e,t))}async makeRequest(e,t){var f,d,m;let r=await e,n=(f=r.maxRetries)!=null?f:this.maxRetries;t==null&&(t=n),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:n-t});if(await this.prepareRequest(a,{url:i,options:r}),pe("request",i,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new L;let c=new AbortController,u=await this.fetchWithTimeout(i,a,o,c).catch(Pr);if(u instanceof Error){if((m=r.signal)!=null&&m.aborted)throw new L;if(t)return this.retryRequest(r,t);throw u.name==="AbortError"?new Re:new Ie({cause:u})}let w=os(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){let E=`retrying, ${t} attempts remaining`;return pe(`response (error; ${E})`,u.status,i,w),this.retryRequest(r,t,w)}let y=await u.text().catch(E=>Pr(E).message),C=fa(y),g=C?void 0:y;throw pe(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,w,g),this.makeStatusError(u.status,C,g,w)}return{response:u,options:r,controller:c}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new ds(this,r,e)}buildURL(e,t){let r=da(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return en(n)||(t={...n,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r!="undefined").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new h(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),r),c={signal:n.signal,...i};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var o;let n,a=r==null?void 0:r["retry-after-ms"];if(a){let c=parseFloat(a);Number.isNaN(c)||(n=c)}let i=r==null?void 0:r["retry-after"];if(i&&!n){let c=parseFloat(i);Number.isNaN(c)?n=Date.parse(i)-Date.now():n=c*1e3}if(!(n&&0<=n&&n<60*1e3)){let c=(o=e.maxRetries)!=null?o:this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,c)}return await ge(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${He}`}},ar=class{constructor(e,t,r,n){Rr.set(this,void 0),aa(this,Rr,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new h("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[n,a]of r)e.url.searchParams.set(n,a);t.query=void 0,t.path=e.url.toString()}return await ia(this,Rr,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Rr=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},ds=class extends _t{constructor(e,t,r){super(t,async n=>new r(e,n.response,await Ys(n),n.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},os=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),oa={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},A=s=>typeof s=="object"&&s!==null&&!en(s)&&Object.keys(s).every(e=>tn(oa,e)),ca=()=>{var e,t;if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":He,"X-Stainless-OS":Ks(Deno.build.os),"X-Stainless-Arch":Gs(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(t=(e=Deno.version)==null?void 0:e.deno)!=null?t:"unknown"};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":He,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":He,"X-Stainless-OS":Ks(process.platform),"X-Stainless-Arch":Gs(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let s=la();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":He,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":He,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function la(){if(typeof navigator=="undefined"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${n}.${a}.${i}`}}}return null}var Gs=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Ks=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Cr,ua=()=>Cr!=null?Cr:Cr=ca(),fa=s=>{try{return JSON.parse(s)}catch(e){return}},ha=/^[a-z][a-z0-9+.-]*:/i,da=s=>ha.test(s),ge=s=>new Promise(e=>setTimeout(e,s)),hs=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new h(`${s} must be an integer`);if(e<0)throw new h(`${s} must be a positive integer`);return e},Pr=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch(e){}return new Error(s)};var ir=s=>{var e,t,r,n,a,i;if(typeof process!="undefined")return(r=(t=(e=process.env)==null?void 0:e[s])==null?void 0:t.trim())!=null?r:void 0;if(typeof Deno!="undefined")return(i=(a=(n=Deno.env)==null?void 0:n.get)==null?void 0:a.call(n,s))==null?void 0:i.trim()};function en(s){if(!s)return!0;for(let e in s)return!1;return!0}function tn(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Qs(s,e){for(let t in e){if(!tn(e,t))continue;let r=t.toLowerCase();if(!r)continue;let n=e[t];n===null?delete s[r]:n!==void 0&&(s[r]=n)}}var zs=new Set(["authorization","api-key"]);function pe(s,...e){var t;if(typeof process!="undefined"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){let r=e.map(n=>{if(!n)return n;if(n.headers){let i={...n,headers:{...n.headers}};for(let o in n.headers)zs.has(o.toLowerCase())&&(i.headers[o]="REDACTED");return i}let a=null;for(let i in n)zs.has(i.toLowerCase())&&(a!=null||(a={...n}),a[i]="REDACTED");return a!=null?a:n});console.log(`OpenAI:DEBUG:${s}`,...r)}}var ma=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),rn=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined",pa=s=>typeof(s==null?void 0:s.get)=="function";var Er=(s,e)=>{var r;let t=e.toLowerCase();if(pa(s)){let n=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(let a of[e,t,e.toUpperCase(),n]){let i=s.get(a);if(i)return i}}for(let[n,a]of Object.entries(s))if(n.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};var sn=s=>{if(typeof Buffer!="undefined"){let e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(s),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return Array.from(new Float32Array(r.buffer))}};function or(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}var ce=class extends ar{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},P=class extends ar{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;let e=this.getPaginatedItems();if(!e.length)return null;let t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}};var l=class{constructor(e){this._client=e}};var wt=class extends l{list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Or,{query:t,...r})}};var Ee=class extends l{constructor(){super(...arguments),this.messages=new wt(this._client)}create(e,t){var r;return this._client.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/chat/completions",Se,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},Se=class extends P{},Or=class extends P{};Ee.ChatCompletionsPage=Se;Ee.Messages=wt;var _e=class extends l{constructor(){super(...arguments),this.completions=new Ee(this._client)}};_e.Completions=Ee;_e.ChatCompletionsPage=Se;var yt=class extends l{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}};var bt=class extends l{create(e,t){var r;return this._client.post("/audio/transcriptions",ee({body:e,...t,stream:(r=e.stream)!=null?r:!1,__metadata:{model:e.model}}))}};var xt=class extends l{create(e,t){return this._client.post("/audio/translations",ee({body:e,...t,__metadata:{model:e.model}}))}};var le=class extends l{constructor(){super(...arguments),this.transcriptions=new bt(this._client),this.translations=new xt(this._client),this.speech=new yt(this._client)}};le.Transcriptions=bt;le.Translations=xt;le.Speech=yt;var Oe=class extends l{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/batches",Ke,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Ke=class extends P{};Oe.BatchesPage=Ke;var re=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},M=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},ms,vr,$r,cr,lr,Fr,ur,we,fr,Tr,kr,At,nn,ve=class{constructor(){ms.add(this),this.controller=new AbortController,vr.set(this,void 0),$r.set(this,()=>{}),cr.set(this,()=>{}),lr.set(this,void 0),Fr.set(this,()=>{}),ur.set(this,()=>{}),we.set(this,{}),fr.set(this,!1),Tr.set(this,!1),kr.set(this,!1),At.set(this,!1),re(this,vr,new Promise((e,t)=>{re(this,$r,e,"f"),re(this,cr,t,"f")}),"f"),re(this,lr,new Promise((e,t)=>{re(this,Fr,e,"f"),re(this,ur,t,"f")}),"f"),M(this,vr,"f").catch(()=>{}),M(this,lr,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},M(this,ms,"m",nn).bind(this))},0)}_connected(){this.ended||(M(this,$r,"f").call(this),this._emit("connect"))}get ended(){return M(this,fr,"f")}get errored(){return M(this,Tr,"f")}get aborted(){return M(this,kr,"f")}abort(){this.controller.abort()}on(e,t){return(M(this,we,"f")[e]||(M(this,we,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=M(this,we,"f")[e];if(!r)return this;let n=r.findIndex(a=>a.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(M(this,we,"f")[e]||(M(this,we,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{re(this,At,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){re(this,At,!0,"f"),await M(this,lr,"f")}_emit(e,...t){if(M(this,fr,"f"))return;e==="end"&&(re(this,fr,!0,"f"),M(this,Fr,"f").call(this));let r=M(this,we,"f")[e];if(r&&(M(this,we,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!M(this,At,"f")&&!(r!=null&&r.length)&&Promise.reject(n),M(this,cr,"f").call(this,n),M(this,ur,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!M(this,At,"f")&&!(r!=null&&r.length)&&Promise.reject(n),M(this,cr,"f").call(this,n),M(this,ur,"f").call(this,n),this._emit("end")}}_emitFinal(){}};vr=new WeakMap,$r=new WeakMap,cr=new WeakMap,lr=new WeakMap,Fr=new WeakMap,ur=new WeakMap,we=new WeakMap,fr=new WeakMap,Tr=new WeakMap,kr=new WeakMap,At=new WeakMap,ms=new WeakSet,nn=function(e){if(re(this,Tr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new L),e instanceof L)return re(this,kr,!0,"f"),this._emit("abort",e);if(e instanceof h)return this._emit("error",e);if(e instanceof Error){let t=new h(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new h(String(e)))};var p=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},K=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},q,ps,ue,Nr,se,ze,Pt,Qe,Lr,Q,Mr,Br,mr,hr,dr,an,on,cn,ln,un,fn,hn,H=class extends ve{constructor(){super(...arguments),q.add(this),ps.set(this,[]),ue.set(this,{}),Nr.set(this,{}),se.set(this,void 0),ze.set(this,void 0),Pt.set(this,void 0),Qe.set(this,void 0),Lr.set(this,void 0),Q.set(this,void 0),Mr.set(this,void 0),Br.set(this,void 0),mr.set(this,void 0)}[(ps=new WeakMap,ue=new WeakMap,Nr=new WeakMap,se=new WeakMap,ze=new WeakMap,Pt=new WeakMap,Qe=new WeakMap,Lr=new WeakMap,Q=new WeakMap,Mr=new WeakMap,Br=new WeakMap,mr=new WeakMap,q=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let a=t.shift();a?a.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let a of t)a.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let a of t)a.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new H;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=J.fromReadableStream(e,this.controller);for await(let i of n)p(this,q,"m",hr).call(this,i);if((a=n.controller.signal)!=null&&a.aborted)throw new L;return this._addRun(p(this,q,"m",dr).call(this))}toReadableStream(){return new J(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n,a){let i=new H;return i._run(()=>i._runToolAssistantStream(e,t,r,n,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,n,a){var u;let i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...n,stream:!0},c=await e.submitToolOutputs(t,r,o,{...a,signal:this.controller.signal});this._connected();for await(let w of c)p(this,q,"m",hr).call(this,w);if((u=c.controller.signal)!=null&&u.aborted)throw new L;return this._addRun(p(this,q,"m",dr).call(this))}static createThreadAssistantStream(e,t,r){let n=new H;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let a=new H;return a._run(()=>a._runAssistantStream(e,t,r,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return p(this,Mr,"f")}currentRun(){return p(this,Br,"f")}currentMessageSnapshot(){return p(this,se,"f")}currentRunStepSnapshot(){return p(this,mr,"f")}async finalRunSteps(){return await this.done(),Object.values(p(this,ue,"f"))}async finalMessages(){return await this.done(),Object.values(p(this,Nr,"f"))}async finalRun(){if(await this.done(),!p(this,ze,"f"))throw Error("Final run was not received.");return p(this,ze,"f")}async _createThreadAssistantStream(e,t,r){var o;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(let c of i)p(this,q,"m",hr).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new L;return this._addRun(p(this,q,"m",dr).call(this))}async _createAssistantStream(e,t,r,n){var c;let a=n==null?void 0:n.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},o=await e.create(t,i,{...n,signal:this.controller.signal});this._connected();for await(let u of o)p(this,q,"m",hr).call(this,u);if((c=o.controller.signal)!=null&&c.aborted)throw new L;return this._addRun(p(this,q,"m",dr).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let a=e[r];if(a==null){e[r]=n;continue}if(r==="index"||r==="type"){e[r]=n;continue}if(typeof a=="string"&&typeof n=="string")a+=n;else if(typeof a=="number"&&typeof n=="number")a+=n;else if(or(a)&&or(n))a=this.accumulateDelta(a,n);else if(Array.isArray(a)&&Array.isArray(n)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...n);continue}for(let i of n){if(!or(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n,a){return await this._createToolAssistantStream(r,e,t,n,a)}};hr=function(e){if(!this.ended)switch(K(this,Mr,e,"f"),p(this,q,"m",cn).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":p(this,q,"m",hn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":p(this,q,"m",on).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":p(this,q,"m",an).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},dr=function(){if(this.ended)throw new h("stream has ended, this shouldn't happen");if(!p(this,ze,"f"))throw Error("Final run has not been received");return p(this,ze,"f")},an=function(e){let[t,r]=p(this,q,"m",un).call(this,e,p(this,se,"f"));K(this,se,t,"f"),p(this,Nr,"f")[t.id]=t;for(let n of r){let a=t.content[n.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type=="text"&&n.text){let a=n.text,i=t.content[n.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=p(this,Pt,"f")){if(p(this,Qe,"f"))switch(p(this,Qe,"f").type){case"text":this._emit("textDone",p(this,Qe,"f").text,p(this,se,"f"));break;case"image_file":this._emit("imageFileDone",p(this,Qe,"f").image_file,p(this,se,"f"));break}K(this,Pt,n.index,"f")}K(this,Qe,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(p(this,Pt,"f")!==void 0){let n=e.data.content[p(this,Pt,"f")];if(n)switch(n.type){case"image_file":this._emit("imageFileDone",n.image_file,p(this,se,"f"));break;case"text":this._emit("textDone",n.text,p(this,se,"f"));break}}p(this,se,"f")&&this._emit("messageDone",e.data),K(this,se,void 0,"f")}},on=function(e){let t=p(this,q,"m",ln).call(this,e);switch(K(this,mr,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let a of r.step_details.tool_calls)a.index==p(this,Lr,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(p(this,Q,"f")&&this._emit("toolCallDone",p(this,Q,"f")),K(this,Lr,a.index,"f"),K(this,Q,t.step_details.tool_calls[a.index],"f"),p(this,Q,"f")&&this._emit("toolCallCreated",p(this,Q,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":K(this,mr,void 0,"f"),e.data.step_details.type=="tool_calls"&&p(this,Q,"f")&&(this._emit("toolCallDone",p(this,Q,"f")),K(this,Q,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},cn=function(e){p(this,ps,"f").push(e),this._emit("event",e)},ln=function(e){switch(e.event){case"thread.run.step.created":return p(this,ue,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=p(this,ue,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=H.accumulateDelta(t,r.delta);p(this,ue,"f")[e.data.id]=n}return p(this,ue,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":p(this,ue,"f")[e.data.id]=e.data;break}if(p(this,ue,"f")[e.data.id])return p(this,ue,"f")[e.data.id];throw new Error("No snapshot available")},un=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let a of n.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=p(this,q,"m",fn).call(this,a,i)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},fn=function(e,t){return H.accumulateDelta(t,e)},hn=function(e){switch(K(this,Br,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":K(this,ze,e.data,"f"),p(this,Q,"f")&&(this._emit("toolCallDone",p(this,Q,"f")),K(this,Q,void 0,"f"));break;case"thread.run.cancelling":break}};var Ye=class extends l{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/assistants",It,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},It=class extends P{};Ye.AssistantsPage=It;function gs(s){return typeof s.parse=="function"}var $e=s=>(s==null?void 0:s.role)==="assistant",_s=s=>(s==null?void 0:s.role)==="function",ws=s=>(s==null?void 0:s.role)==="tool";function pr(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function Ze(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function dn(s,e){return!e||!ys(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:gr(s,e)}function gr(s,e){let t=s.choices.map(r=>{var n,a;if(r.finish_reason==="length")throw new pt;if(r.finish_reason==="content_filter")throw new gt;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:(a=(n=r.message.tool_calls)==null?void 0:n.map(i=>Pa(e,i)))!=null?a:void 0}:void 0,parsed:r.message.content&&!r.message.refusal?Aa(e,r.message.content):null}}});return{...s,choices:t}}function Aa(s,e){var t,r;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=s.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function Pa(s,e){var r;let t=(r=s.tools)==null?void 0:r.find(n=>{var a;return((a=n.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Ze(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function mn(s,e){var r;if(!s)return!1;let t=(r=s.tools)==null?void 0:r.find(n=>{var a;return((a=n.function)==null?void 0:a.name)===e.function.name});return Ze(t)||(t==null?void 0:t.function.strict)||!1}function ys(s){var e,t;return pr(s.response_format)?!0:(t=(e=s.tools)==null?void 0:e.some(r=>Ze(r)||r.type==="function"&&r.function.strict===!0))!=null?t:!1}function pn(s){for(let e of s!=null?s:[]){if(e.type!=="function")throw new h(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new h(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var V=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},W,bs,Dr,xs,As,Ps,_n,Is,gn=10,Rt=class extends ve{constructor(){super(...arguments),W.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(_s(e)||ws(e))&&e.content)this._emit("functionCallResult",e.content);else if($e(e)&&e.function_call)this._emit("functionCall",e.function_call);else if($e(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new h("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),V(this,W,"m",bs).call(this)}async finalMessage(){return await this.done(),V(this,W,"m",Dr).call(this)}async finalFunctionCall(){return await this.done(),V(this,W,"m",xs).call(this)}async finalFunctionCallResult(){return await this.done(),V(this,W,"m",As).call(this)}async totalUsage(){return await this.done(),V(this,W,"m",Ps).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=V(this,W,"m",Dr).call(this);t&&this._emit("finalMessage",t);let r=V(this,W,"m",bs).call(this);r&&this._emit("finalContent",r);let n=V(this,W,"m",xs).call(this);n&&this._emit("finalFunctionCall",n);let a=V(this,W,"m",As).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",V(this,W,"m",Ps).call(this))}async _createChatCompletion(e,t,r){let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),V(this,W,"m",_n).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(gr(a,t))}async _runChatCompletion(e,t,r){for(let n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var d;let n="function",{function_call:a="auto",stream:i,...o}=t,c=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=gn}=r||{},w={};for(let m of t.functions)w[m.name||m.function.name]=m;let f=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(let m of t.messages)this._addMessage(m,!1);for(let m=0;m<u;++m){let C=(d=(await this._createChatCompletion(e,{...o,function_call:a,functions:f,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!C)throw new h("missing message in ChatCompletion response");if(!C.function_call)return;let{name:g,arguments:k}=C.function_call,_=w[g];if(_){if(c&&c!==g){let T=`Invalid function_call: ${JSON.stringify(g)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,name:g,content:T});continue}}else{let T=`Invalid function_call: ${JSON.stringify(g)}. Available options are: ${f.map($=>JSON.stringify($.name)).join(", ")}. Please try again`;this._addMessage({role:n,name:g,content:T});continue}let E;try{E=gs(_)?await _.parse(k):k}catch(T){this._addMessage({role:n,name:g,content:T instanceof Error?T.message:String(T)});continue}let N=await _.function(E,this),b=V(this,W,"m",Is).call(this,N);if(this._addMessage({role:n,name:g,content:b}),c)return}}async _runTools(e,t,r){var m,y,C;let n="tool",{tool_choice:a="auto",stream:i,...o}=t,c=typeof a!="string"&&((m=a==null?void 0:a.function)==null?void 0:m.name),{maxChatCompletions:u=gn}=r||{},w=t.tools.map(g=>{if(Ze(g)){if(!g.$callback)throw new h("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:g.$callback,name:g.function.name,description:g.function.description||"",parameters:g.function.parameters,parse:g.$parseRaw,strict:!0}}}return g}),f={};for(let g of w)g.type==="function"&&(f[g.function.name||g.function.function.name]=g.function);let d="tools"in t?w.map(g=>g.type==="function"?{type:"function",function:{name:g.function.name||g.function.function.name,parameters:g.function.parameters,description:g.function.description,strict:g.function.strict}}:g):void 0;for(let g of t.messages)this._addMessage(g,!1);for(let g=0;g<u;++g){let _=(y=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:y.message;if(!_)throw new h("missing message in ChatCompletion response");if(!((C=_.tool_calls)!=null&&C.length))return;for(let E of _.tool_calls){if(E.type!=="function")continue;let N=E.id,{name:b,arguments:T}=E.function,$=f[b];if($){if(c&&c!==b){let F=`Invalid tool_call: ${JSON.stringify(b)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,tool_call_id:N,content:F});continue}}else{let F=`Invalid tool_call: ${JSON.stringify(b)}. Available options are: ${Object.keys(f).map(S=>JSON.stringify(S)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:N,content:F});continue}let v;try{v=gs($)?await $.parse(T):T}catch(F){let S=F instanceof Error?F.message:String(F);this._addMessage({role:n,tool_call_id:N,content:S});continue}let I=await $.function(v,this),R=V(this,W,"m",Is).call(this,I);if(this._addMessage({role:n,tool_call_id:N,content:R}),c)return}}}};W=new WeakSet,bs=function(){var e;return(e=V(this,W,"m",Dr).call(this).content)!=null?e:null},Dr=function(){var t,r;let e=this.messages.length;for(;e-- >0;){let n=this.messages[e];if($e(n)){let{function_call:a,...i}=n,o={...i,content:(t=n.content)!=null?t:null,refusal:(r=n.refusal)!=null?r:null};return a&&(o.function_call=a),o}}throw new h("stream ended without producing a ChatCompletionMessage with role=assistant")},xs=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){let n=this.messages[r];if($e(n)&&(n!=null&&n.function_call))return n.function_call;if($e(n)&&((e=n==null?void 0:n.tool_calls)!=null&&e.length))return(t=n.tool_calls.at(-1))==null?void 0:t.function}},As=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(_s(t)&&t.content!=null||ws(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var n;return r.role==="assistant"&&((n=r.tool_calls)==null?void 0:n.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Ps=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},_n=function(e){if(e.n!=null&&e.n>1)throw new h("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Is=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Fe=class extends Rt{static runFunctions(e,t,r){let n=new Fe,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,a)),n}static runTools(e,t,r){let n=new Fe,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,a)),n}_addMessage(e,t=!0){super._addMessage(e,t),$e(e)&&e.content&&this._emit("content",e.content)}};var U={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Rs=class extends Error{},Cs=class extends Error{};function Ia(s,e=U.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return Ra(s.trim(),e)}var Ra=(s,e)=>{let t=s.length,r=0,n=d=>{throw new Rs(`${d} at position ${r}`)},a=d=>{throw new Cs(`${d} at position ${r}`)},i=()=>(f(),r>=t&&n("Unexpected end of input"),s[r]==='"'?o():s[r]==="{"?c():s[r]==="["?u():s.substring(r,r+4)==="null"||U.NULL&e&&t-r<4&&"null".startsWith(s.substring(r))?(r+=4,null):s.substring(r,r+4)==="true"||U.BOOL&e&&t-r<4&&"true".startsWith(s.substring(r))?(r+=4,!0):s.substring(r,r+5)==="false"||U.BOOL&e&&t-r<5&&"false".startsWith(s.substring(r))?(r+=5,!1):s.substring(r,r+8)==="Infinity"||U.INFINITY&e&&t-r<8&&"Infinity".startsWith(s.substring(r))?(r+=8,1/0):s.substring(r,r+9)==="-Infinity"||U.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(s.substring(r))?(r+=9,-1/0):s.substring(r,r+3)==="NaN"||U.NAN&e&&t-r<3&&"NaN".startsWith(s.substring(r))?(r+=3,NaN):w()),o=()=>{let d=r,m=!1;for(r++;r<t&&(s[r]!=='"'||m&&s[r-1]==="\\");)m=s[r]==="\\"?!m:!1,r++;if(s.charAt(r)=='"')try{return JSON.parse(s.substring(d,++r-Number(m)))}catch(y){a(String(y))}else if(U.STR&e)try{return JSON.parse(s.substring(d,r-Number(m))+'"')}catch(y){return JSON.parse(s.substring(d,s.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},c=()=>{r++,f();let d={};try{for(;s[r]!=="}";){if(f(),r>=t&&U.OBJ&e)return d;let m=o();f(),r++;try{let y=i();Object.defineProperty(d,m,{value:y,writable:!0,enumerable:!0,configurable:!0})}catch(y){if(U.OBJ&e)return d;throw y}f(),s[r]===","&&r++}}catch(m){if(U.OBJ&e)return d;n("Expected '}' at end of object")}return r++,d},u=()=>{r++;let d=[];try{for(;s[r]!=="]";)d.push(i()),f(),s[r]===","&&r++}catch(m){if(U.ARR&e)return d;n("Expected ']' at end of array")}return r++,d},w=()=>{if(r===0){s==="-"&&U.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s)}catch(m){if(U.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(y){}a(String(m))}}let d=r;for(s[r]==="-"&&r++;s[r]&&!",]}".includes(s[r]);)r++;r==t&&!(U.NUM&e)&&n("Unterminated number literal");try{return JSON.parse(s.substring(d,r))}catch(m){s.substring(d,r)==="-"&&U.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s.substring(d,s.lastIndexOf("e")))}catch(y){a(String(y))}}},f=()=>{for(;r<t&&` 
\r	`.includes(s[r]);)r++};return i()},Es=s=>Ia(s,U.ALL^U.NUM);var Ct=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},O=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},j,ye,Et,Te,Ss,jr,Os,vs,$s,Ur,Fs,wn,be=class extends Rt{constructor(e){super(),j.add(this),ye.set(this,void 0),Et.set(this,void 0),Te.set(this,void 0),Ct(this,ye,e,"f"),Ct(this,Et,[],"f")}get currentChatCompletionSnapshot(){return O(this,Te,"f")}static fromReadableStream(e){let t=new be(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new be(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){var i;super._createChatCompletion;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),O(this,j,"m",Ss).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of a)O(this,j,"m",Os).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new L;return this._addChatCompletion(O(this,j,"m",Ur).call(this))}async _fromReadableStream(e,t){var i;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),O(this,j,"m",Ss).call(this),this._connected();let n=J.fromReadableStream(e,this.controller),a;for await(let o of n)a&&a!==o.id&&this._addChatCompletion(O(this,j,"m",Ur).call(this)),O(this,j,"m",Os).call(this,o),a=o.id;if((i=n.controller.signal)!=null&&i.aborted)throw new L;return this._addChatCompletion(O(this,j,"m",Ur).call(this))}[(ye=new WeakMap,Et=new WeakMap,Te=new WeakMap,j=new WeakSet,Ss=function(){this.ended||Ct(this,Te,void 0,"f")},jr=function(t){let r=O(this,Et,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},O(this,Et,"f")[t.index]=r,r)},Os=function(t){var n,a,i,o,c,u,w,f,d,m,y,C,g,k,_,E,N,b,T,$;if(this.ended)return;let r=O(this,j,"m",wn).call(this,t);this._emit("chunk",t,r);for(let v of t.choices){let I=r.choices[v.index];v.delta.content!=null&&((n=I.message)==null?void 0:n.role)==="assistant"&&((a=I.message)!=null&&a.content)&&(this._emit("content",v.delta.content,I.message.content),this._emit("content.delta",{delta:v.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),v.delta.refusal!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((o=I.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:v.delta.refusal,snapshot:I.message.refusal}),((c=v.logprobs)==null?void 0:c.content)!=null&&((u=I.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(w=v.logprobs)==null?void 0:w.content,snapshot:(d=(f=I.logprobs)==null?void 0:f.content)!=null?d:[]}),((m=v.logprobs)==null?void 0:m.refusal)!=null&&((y=I.message)==null?void 0:y.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(C=v.logprobs)==null?void 0:C.refusal,snapshot:(k=(g=I.logprobs)==null?void 0:g.refusal)!=null?k:[]});let R=O(this,j,"m",jr).call(this,I);I.finish_reason&&(O(this,j,"m",$s).call(this,I),R.current_tool_call_index!=null&&O(this,j,"m",vs).call(this,I,R.current_tool_call_index));for(let F of(_=v.delta.tool_calls)!=null?_:[])R.current_tool_call_index!==F.index&&(O(this,j,"m",$s).call(this,I),R.current_tool_call_index!=null&&O(this,j,"m",vs).call(this,I,R.current_tool_call_index)),R.current_tool_call_index=F.index;for(let F of(E=v.delta.tool_calls)!=null?E:[]){let S=(N=I.message.tool_calls)==null?void 0:N[F.index];S!=null&&S.type&&((S==null?void 0:S.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(b=S.function)==null?void 0:b.name,index:F.index,arguments:S.function.arguments,parsed_arguments:S.function.parsed_arguments,arguments_delta:($=(T=F.function)==null?void 0:T.arguments)!=null?$:""}):(S==null||S.type,void 0))}}},vs=function(t,r){var i,o,c;if(O(this,j,"m",jr).call(this,t).done_tool_calls.has(r))return;let a=(i=t.message.tool_calls)==null?void 0:i[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){let u=(c=(o=O(this,ye,"f"))==null?void 0:o.tools)==null?void 0:c.find(w=>w.type==="function"&&w.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Ze(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},$s=function(t){var n,a;let r=O(this,j,"m",jr).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let i=O(this,j,"m",Fs).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(n=t.logprobs)!=null&&n.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Ur=function(){if(this.ended)throw new h("stream has ended, this shouldn't happen");let t=O(this,Te,"f");if(!t)throw new h("request ended without sending any chunks");return Ct(this,Te,void 0,"f"),Ct(this,Et,[],"f"),Ca(t,O(this,ye,"f"))},Fs=function(){var r;let t=(r=O(this,ye,"f"))==null?void 0:r.response_format;return pr(t)?t:null},wn=function(t){var w,f,d,m,y,C;var r,n,a,i;let o=O(this,Te,"f"),{choices:c,...u}=t;o?Object.assign(o,u):o=Ct(this,Te,{...u,choices:[]},"f");for(let{delta:g,finish_reason:k,index:_,logprobs:E=null,...N}of t.choices){let b=o.choices[_];if(b||(b=o.choices[_]={finish_reason:k,index:_,message:{},logprobs:E,...N}),E)if(!b.logprobs)b.logprobs=Object.assign({},E);else{let{content:S,refusal:Z,...me}=E;Object.assign(b.logprobs,me),S&&((w=(r=b.logprobs).content)!=null||(r.content=[]),b.logprobs.content.push(...S)),Z&&((f=(n=b.logprobs).refusal)!=null||(n.refusal=[]),b.logprobs.refusal.push(...Z))}if(k&&(b.finish_reason=k,O(this,ye,"f")&&ys(O(this,ye,"f")))){if(k==="length")throw new pt;if(k==="content_filter")throw new gt}if(Object.assign(b,N),!g)continue;let{content:T,refusal:$,function_call:v,role:I,tool_calls:R,...F}=g;if(Object.assign(b.message,F),$&&(b.message.refusal=(b.message.refusal||"")+$),I&&(b.message.role=I),v&&(b.message.function_call?(v.name&&(b.message.function_call.name=v.name),v.arguments&&((d=(a=b.message.function_call).arguments)!=null||(a.arguments=""),b.message.function_call.arguments+=v.arguments)):b.message.function_call=v),T&&(b.message.content=(b.message.content||"")+T,!b.message.refusal&&O(this,j,"m",Fs).call(this)&&(b.message.parsed=Es(b.message.content))),R){b.message.tool_calls||(b.message.tool_calls=[]);for(let{index:S,id:Z,type:me,function:X,...On}of R){let ae=(m=(i=b.message.tool_calls)[S])!=null?m:i[S]={};Object.assign(ae,On),Z&&(ae.id=Z),me&&(ae.type=me),X&&((C=ae.function)!=null||(ae.function={name:(y=X.name)!=null?y:"",arguments:""})),X!=null&&X.name&&(ae.function.name=X.name),X!=null&&X.arguments&&(ae.function.arguments+=X.arguments,mn(O(this,ye,"f"),ae)&&(ae.function.parsed_arguments=Es(ae.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",n=>{let a=t.shift();a?a.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let a of t)a.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let a of t)a.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new J(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Ca(s,e){let{id:t,choices:r,created:n,model:a,system_fingerprint:i,...o}=s,c={...o,id:t,choices:r.map(({message:u,finish_reason:w,index:f,logprobs:d,...m})=>{var E,N,b;if(!w)throw new h(`missing finish_reason for choice ${f}`);let{content:y=null,function_call:C,tool_calls:g,...k}=u,_=u.role;if(!_)throw new h(`missing role for choice ${f}`);if(C){let{arguments:T,name:$}=C;if(T==null)throw new h(`missing function_call.arguments for choice ${f}`);if(!$)throw new h(`missing function_call.name for choice ${f}`);return{...m,message:{content:y,function_call:{arguments:T,name:$},role:_,refusal:(E=u.refusal)!=null?E:null},finish_reason:w,index:f,logprobs:d}}return g?{...m,index:f,finish_reason:w,logprobs:d,message:{...k,role:_,content:y,refusal:(N=u.refusal)!=null?N:null,tool_calls:g.map((T,$)=>{let{function:v,type:I,id:R,...F}=T,{arguments:S,name:Z,...me}=v||{};if(R==null)throw new h(`missing choices[${f}].tool_calls[${$}].id
${qr(s)}`);if(I==null)throw new h(`missing choices[${f}].tool_calls[${$}].type
${qr(s)}`);if(Z==null)throw new h(`missing choices[${f}].tool_calls[${$}].function.name
${qr(s)}`);if(S==null)throw new h(`missing choices[${f}].tool_calls[${$}].function.arguments
${qr(s)}`);return{...F,id:R,type:I,function:{...me,name:Z,arguments:S}}})}}:{...m,message:{...k,content:y,role:_,refusal:(b=u.refusal)!=null?b:null},finish_reason:w,index:f,logprobs:d}}),created:n,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return dn(c,e)}function qr(s){return JSON.stringify(s)}var xe=class extends be{static fromReadableStream(e){let t=new xe(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let n=new xe(null),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,a)),n}static runTools(e,t,r){let n=new xe(t),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,a)),n}};var _r=class extends l{parse(e,t){return pn(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>gr(r,e))}runFunctions(e,t){return e.stream?xe.runFunctions(this._client,e,t):Fe.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?xe.runTools(this._client,e,t):Fe.runTools(this._client,e,t)}stream(e,t){return be.createChatCompletion(this._client,e,t)}};var St=class extends l{constructor(){super(...arguments),this.completions=new _r(this._client)}};(function(s){s.Completions=_r})(St||(St={}));var Ot=class extends l{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}};var vt=class extends l{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}};var ke=class extends l{constructor(){super(...arguments),this.sessions=new Ot(this._client),this.transcriptionSessions=new vt(this._client)}};ke.Sessions=Ot;ke.TranscriptionSessions=vt;var et=class extends l{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,$t,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},$t=class extends P{};et.MessagesPage=$t;var tt=class extends l{retrieve(e,t,r,n={},a){return A(n)?this.retrieve(e,t,r,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:n,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,r={},n){return A(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Ft,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}},Ft=class extends P{};tt.RunStepsPage=Ft;var Ae=class extends l{constructor(){super(...arguments),this.steps=new tt(this._client)}create(e,t,r){var i;let{include:n,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:(i=t.stream)!=null?i:!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Tt,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}createAndStream(e,t,r){return H.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...n}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let c=i.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(o=u)}}await ge(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return H.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,n){var a;return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:(a=r.stream)!=null?a:!1})}async submitToolOutputsAndPoll(e,t,r,n){let a=await this.submitToolOutputs(e,t,r,n);return await this.poll(e,a.id,n)}submitToolOutputsStream(e,t,r,n){return H.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,n)}},Tt=class extends P{};Ae.RunsPage=Tt;Ae.Steps=tt;Ae.RunStepsPage=Ft;var fe=class extends l{constructor(){super(...arguments),this.runs=new Ae(this._client),this.messages=new et(this._client)}create(e={},t){return A(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){var r;return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:(r=e.stream)!=null?r:!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return H.createThreadAssistantStream(e,this._client.beta.threads,t)}};fe.Runs=Ae;fe.RunsPage=Tt;fe.Messages=et;fe.MessagesPage=$t;var ne=class extends l{constructor(){super(...arguments),this.realtime=new ke(this._client),this.chat=new St(this._client),this.assistants=new Ye(this._client),this.threads=new fe(this._client)}};ne.Realtime=ke;ne.Assistants=Ye;ne.AssistantsPage=It;ne.Threads=fe;var rt=class extends l{create(e,t){var r;return this._client.post("/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}};var st=class extends l{create(e,t){let r=!!e.encoding_format,n=r?e.encoding_format:"base64";r&&pe("Request","User defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?a:(pe("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{let c=o.embedding;o.embedding=sn(c)}),i)))}};var nt=class extends l{retrieve(e,t,r,n){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,n)}list(e,t,r={},n){return A(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,kt,{query:r,...n})}},kt=class extends P{};nt.OutputItemListResponsesPage=kt;var Pe=class extends l{constructor(){super(...arguments),this.outputItems=new nt(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Nt,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}},Nt=class extends P{};Pe.RunListResponsesPage=Nt;Pe.OutputItems=nt;Pe.OutputItemListResponsesPage=kt;var he=class extends l{constructor(){super(...arguments),this.runs=new Pe(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/evals",at,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},at=class extends P{};he.EvalListResponsesPage=at;he.Runs=Pe;he.RunListResponsesPage=Nt;var Ne=class extends l{create(e,t){return this._client.post("/files",ee({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/files",it,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let n=new Set(["processed","error","deleted"]),a=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await ge(t),i=await this.retrieve(e),Date.now()-a>r)throw new Re({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},it=class extends P{};Ne.FileObjectsPage=it;var Mt=class extends l{};var Bt=class extends l{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var ot=class extends l{constructor(){super(...arguments),this.graders=new Bt(this._client)}};ot.Graders=Bt;var ct=class extends l{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Lt,{body:t,method:"post",...r})}retrieve(e,t={},r){return A(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}},Lt=class extends ce{};ct.PermissionCreateResponsesPage=Lt;var Me=class extends l{constructor(){super(...arguments),this.permissions=new ct(this._client)}};Me.Permissions=ct;Me.PermissionCreateResponsesPage=Lt;var lt=class extends l{list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Dt,{query:t,...r})}},Dt=class extends P{};lt.FineTuningJobCheckpointsPage=Dt;var de=class extends l{constructor(){super(...arguments),this.checkpoints=new lt(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",jt,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return A(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ut,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},jt=class extends P{},Ut=class extends P{};de.FineTuningJobsPage=jt;de.FineTuningJobEventsPage=Ut;de.Checkpoints=lt;de.FineTuningJobCheckpointsPage=Dt;var z=class extends l{constructor(){super(...arguments),this.methods=new Mt(this._client),this.jobs=new de(this._client),this.checkpoints=new Me(this._client),this.alpha=new ot(this._client)}};z.Methods=Mt;z.Jobs=de;z.FineTuningJobsPage=jt;z.FineTuningJobEventsPage=Ut;z.Checkpoints=Me;z.Alpha=ot;var qt=class extends l{};var Be=class extends l{constructor(){super(...arguments),this.graderModels=new qt(this._client)}};Be.GraderModels=qt;var ut=class extends l{createVariation(e,t){return this._client.post("/images/variations",ee({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ee({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var Le=class extends l{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ft,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},ft=class extends ce{};Le.ModelsPage=ft;var ht=class extends l{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function yn(s,e){return!e||!Xa(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Ts(s,e)}function Ts(s,e){let t=s.output.map(n=>{if(n.type==="function_call")return{...n,parsed_arguments:Qa(e,n)};if(n.type==="message"){let a=n.content.map(i=>i.type==="output_text"?{...i,parsed:Va(e,i.text)}:i);return{...n,content:a}}return n}),r=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||ks(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let n of r.output)if(n.type==="message"){for(let a of n.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function Va(s,e){var t,r,n,a;return((r=(t=s.text)==null?void 0:t.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((n=s.text)==null?void 0:n.format)?((a=s.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function Xa(s){var e;return!!pr((e=s.text)==null?void 0:e.format)}function Ga(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Ka(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function Qa(s,e){var r;let t=Ka((r=s.tools)!=null?r:[],e.name);return{...e,...e,parsed_arguments:Ga(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function ks(s){let e=[];for(let t of s.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);s.output_text=e.join("")}var Wt=class extends l{list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,Wr,{query:t,...r})}};var Jt=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},De=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},Ht,Jr,je,Hr,bn,xn,An,Pn,Vt=class extends ve{constructor(e){super(),Ht.add(this),Jr.set(this,void 0),je.set(this,void 0),Hr.set(this,void 0),Jt(this,Jr,e,"f")}static createResponse(e,t,r){let n=new Vt(t);return n._run(()=>n._createResponse(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createResponse(e,t,r){var i;let n=r==null?void 0:r.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),De(this,Ht,"m",bn).call(this);let a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of a)De(this,Ht,"m",xn).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new L;return De(this,Ht,"m",An).call(this)}[(Jr=new WeakMap,je=new WeakMap,Hr=new WeakMap,Ht=new WeakSet,bn=function(){this.ended||Jt(this,je,void 0,"f")},xn=function(t){if(this.ended)return;let r=De(this,Ht,"m",Pn).call(this,t);switch(this._emit("event",t),t.type){case"response.output_text.delta":{let n=r.output[t.output_index];if(!n)throw new h(`missing output at index ${t.output_index}`);if(n.type==="message"){let a=n.content[t.content_index];if(!a)throw new h(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new h(`expected content to be 'output_text', got ${a.type}`);this._emit("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{let n=r.output[t.output_index];if(!n)throw new h(`missing output at index ${t.output_index}`);n.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...t,snapshot:n.arguments});break}default:this._emit(t.type,t);break}},An=function(){if(this.ended)throw new h("stream has ended, this shouldn't happen");let t=De(this,je,"f");if(!t)throw new h("request ended without sending any events");Jt(this,je,void 0,"f");let r=Ya(t,De(this,Jr,"f"));return Jt(this,Hr,r,"f"),r},Pn=function(t){let r=De(this,je,"f");if(!r){if(t.type!=="response.created")throw new h(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Jt(this,je,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let n=r.output[t.output_index];if(!n)throw new h(`missing output at index ${t.output_index}`);n.type==="message"&&n.content.push(t.part);break}case"response.output_text.delta":{let n=r.output[t.output_index];if(!n)throw new h(`missing output at index ${t.output_index}`);if(n.type==="message"){let a=n.content[t.content_index];if(!a)throw new h(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new h(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{let n=r.output[t.output_index];if(!n)throw new h(`missing output at index ${t.output_index}`);n.type==="function_call"&&(n.arguments+=t.delta);break}case"response.completed":{Jt(this,je,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let a=t.shift();a?a.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let a of t)a.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let a of t)a.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=De(this,Hr,"f");if(!e)throw new h("stream ended without producing a ChatCompletion");return e}};function Ya(s,e){return yn(s,e)}var Ue=class extends l{constructor(){super(...arguments),this.inputItems=new Wt(this._client)}create(e,t){var r;return this._client.post("/responses",{body:e,...t,stream:(r=e.stream)!=null?r:!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&ks(n),n))}retrieve(e,t={},r){return A(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...r})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Ts(r,e))}stream(e,t){return Vt.createResponse(this._client,e,t)}},Wr=class extends P{};Ue.InputItems=Wt;var Xt=class extends l{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,ee({body:t,...r}))}};var qe=class extends l{constructor(){super(...arguments),this.parts=new Xt(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};qe.Parts=Xt;var In=async s=>{let e=await Promise.allSettled(s),t=e.filter(n=>n.status==="rejected");if(t.length){for(let n of t)console.error(n.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let n of e)n.status==="fulfilled"&&r.push(n.value);return r};var We=class extends l{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,n){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},r){return A(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Je,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let a=await this.retrieve(e,t,{...r,headers:n}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let c=a.response.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(o=u)}}await ge(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Gt,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},Je=class extends P{},Gt=class extends ce{};We.VectorStoreFilesPage=Je;We.FileContentResponsesPage=Gt;var Kt=class extends l{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r={},n){return A(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Je,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async poll(e,t,r){let n={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:n}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{let c=i.headers.get("openai-poll-after-ms");if(c){let u=parseInt(c);isNaN(u)||(o=u)}}await ge(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){var d;if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=(d=n==null?void 0:n.maxConcurrency)!=null?d:5,i=Math.min(a,t.length),o=this._client,c=t.values(),u=[...r];async function w(m){for(let y of m){let C=await o.files.create({file:y,purpose:"assistants"},n);u.push(C.id)}}let f=Array(i).fill(c).map(w);return await In(f),await this.createAndPoll(e,{file_ids:u})}};var Y=class extends l{constructor(){super(...arguments),this.files=new We(this._client),this.fileBatches=new Kt(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return A(e)?this.list({},e):this._client.getAPIList("/vector_stores",dt,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,mt,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},dt=class extends P{},mt=class extends ce{};Y.VectorStoresPage=dt;Y.VectorStoreSearchResponsesPage=mt;Y.Files=We;Y.VectorStoreFilesPage=Je;Y.FileContentResponsesPage=Gt;Y.FileBatches=Kt;var Rn,x=class extends Sr{constructor({baseURL:e=ir("OPENAI_BASE_URL"),apiKey:t=ir("OPENAI_API_KEY"),organization:r=(i=>(i=ir("OPENAI_ORG_ID"))!=null?i:null)(),project:n=(o=>(o=ir("OPENAI_PROJECT_ID"))!=null?o:null)(),...a}={}){var u;if(t===void 0)throw new h("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let c={apiKey:t,organization:r,project:n,...a,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&rn())throw new h(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:c.baseURL,timeout:(u=c.timeout)!=null?u:6e5,httpAgent:c.httpAgent,maxRetries:c.maxRetries,fetch:c.fetch}),this.completions=new rt(this),this.chat=new _e(this),this.embeddings=new st(this),this.files=new Ne(this),this.images=new ut(this),this.audio=new le(this),this.moderations=new ht(this),this.models=new Le(this),this.fineTuning=new z(this),this.graders=new Be(this),this.vectorStores=new Y(this),this.beta=new ne(this),this.batches=new Oe(this),this.uploads=new qe(this),this.responses=new Ue(this),this.evals=new he(this),this._options=c,this.apiKey=t,this.organization=r,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return zr(e,{arrayFormat:"brackets"})}};Rn=x;x.OpenAI=Rn;x.DEFAULT_TIMEOUT=6e5;x.OpenAIError=h;x.APIError=B;x.APIConnectionError=Ie;x.APIConnectionTimeoutError=Re;x.APIUserAbortError=L;x.NotFoundError=Zt;x.ConflictError=er;x.RateLimitError=rr;x.BadRequestError=Qt;x.AuthenticationError=zt;x.InternalServerError=sr;x.PermissionDeniedError=Yt;x.UnprocessableEntityError=tr;x.toFile=us;x.fileFromPath=xr;x.Completions=rt;x.Chat=_e;x.ChatCompletionsPage=Se;x.Embeddings=st;x.Files=Ne;x.FileObjectsPage=it;x.Images=ut;x.Audio=le;x.Moderations=ht;x.Models=Le;x.ModelsPage=ft;x.FineTuning=z;x.Graders=Be;x.VectorStores=Y;x.VectorStoresPage=dt;x.VectorStoreSearchResponsesPage=mt;x.Beta=ne;x.Batches=Oe;x.BatchesPage=Ke;x.Uploads=qe;x.Responses=Ue;x.Evals=he;x.EvalListResponsesPage=at;var Cn=x;var En="ai-text-extractor-config.md",Sn={apiKey:"",model:"gpt-4o-mini"},Vr=class extends te.Plugin{async onload(){this.app.workspace.onLayoutReady(async()=>{await this.loadSettings()}),this.addRibbonIcon("scan","Extract Text from Image",()=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async r=>{var a;let n=(a=r.target.files)==null?void 0:a[0];if(n){let i=new FileReader;i.onload=async o=>{var u;let c=((u=o.target)==null?void 0:u.result).split(",")[1];await this.extractTextFromImage(c)},i.readAsDataURL(n)}},t.click()}),this.addCommand({id:"capture-image-extract-text",name:"Extract Text from Image",callback:()=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async r=>{var a;let n=(a=r.target.files)==null?void 0:a[0];if(n){let i=new FileReader;i.onload=async o=>{var u;let c=((u=o.target)==null?void 0:u.result).split(",")[1];await this.extractTextFromImage(c)},i.readAsDataURL(n)}},t.click()}})}onunload(){}async loadSettings(){this.settings={...Sn};let t=async(r,n)=>{let a=(0,te.normalizePath)(n),i=r.getAbstractFileByPath(a);return i instanceof te.TFile?await r.read(i):null};try{let r=await t(this.app.vault,En);if(r)this.settings=JSON.parse(r);else{let n=JSON.stringify(Sn,null,2);await this.app.vault.create(En,n)}}catch(r){console.warn("Error loading settings:",r),console.warn("Using default settings")}}async saveSettings(){}arrayBufferToBase64(t){let r="",n=new Uint8Array(t);for(let a of n)r+=String.fromCharCode(a);return btoa(r)}async extractTextFromImage(t){var n,a,i,o,c;if(!this.settings.apiKey){new te.Notice(`Please set your OpenAI API key in plugin settings ${this.settings}`);return}new te.Notice("Extracting text from image...");let r=new Cn({apiKey:this.settings.apiKey,dangerouslyAllowBrowser:!0});try{let w=(o=(i=(a=(n=(await r.chat.completions.create({model:this.settings.model,messages:[{role:"user",content:[{type:"text",text:"Extract all text from the following image. Provide only the extracted text."},{type:"image_url",image_url:{url:`data:image/png;base64,${t}`}}]}]})).choices)==null?void 0:n[0])==null?void 0:a.message)==null?void 0:i.content)!=null?o:"",f=this.app.workspace.getActiveFile();if(!f){new te.Notice("No active file found. Please open a file first.");return}let y=await this.app.vault.read(f)+`

---

`+w;await this.app.vault.modify(f,y),new te.Notice("Text extracted and appended to current file")}catch(u){console.error(u),new te.Notice(`Error extracting text: ${(c=u.message)!=null?c:u}`)}}};
